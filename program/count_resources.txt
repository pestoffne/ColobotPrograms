string _(string key, int value) {
	if (value == 0) {
		return "";
	}
	
	return key + "(" + value + ") ";
}

string _(string key, float value, int base) {
	if (base == 0) {
		return "";
	}
	
	return key + "(" + value + " / " + base + ") ";
}

extern void object::CountResources() {
	int bots[]; object[] items; float power_cells_charge_sum; float nuclear_cells_charge_sum; int i;
	int titanium_count, titanium_ores_count, power_cells_count, nuclear_cells_count, uranium_ores_count, black_boxes_count, orga_matters_count, tnt_count, wreck_count;
	EBoost e(this);
	
	bots = e.list_objects_with_slot();
	
	titanium_count = sizeof(radarall(Titanium));
	titanium_ores_count = sizeof(radarall(TitaniumOre));
	uranium_ores_count = sizeof(radarall(UraniumOre));
	black_boxes_count = sizeof(radarall(BlackBox));
	orga_matters_count = sizeof(radarall(OrgaMatter));
	tnt_count = sizeof(radarall(TNT));
	wreck_count = sizeof(radarall(e.list_recyclable()));
	
	items = radarall(PowerCell);
	power_cells_count = sizeof(items);
	
	power_cells_charge_sum = 0;
	for (int i = sizeof(items) - 1; i >= 0; --i) {
		power_cells_charge_sum += e.max(items[i].energyLevel, 0);
	}
	
	items = radarall(NuclearCell);
	nuclear_cells_count = sizeof(items);
	
	nuclear_cells_charge_sum = 0;
	for (int i = sizeof(items) - 1; i >= 0; --i) {
		nuclear_cells_charge_sum += e.max(items[i].energyLevel, 0);
	}
	
	// Count current bot's PowerCell or NuclearCell in EnercyCell slot
	if (energyCell.category == PowerCell) {
		power_cells_count++;
		power_cells_charge_sum += e.max(energyCell.energyLevel, 0);
	} else if (energyCell.category == NuclearCell) {
		nuclear_cells_count++;
		nuclear_cells_charge_sum += e.max(energyCell.energyLevel, 0);
	} else {
		message("Unexpected cell type", DisplayError);
		return;
	}
	
	// Count current bot's loaded (= grabbed) item
	if (load != null) {
		if (load.category == Titanium) {
			titanium_count++;
		} else if (load.category == TitaniumOre) {
			titanium_ores_count++;
		} else if (load.category == PowerCell) {
			power_cells_count++;
			power_cells_charge_sum += e.max(load.energyLevel, 0);
		} else if (load.category == NuclearCell) {
			nuclear_cells_count++;
			nuclear_cells_charge_sum += e.max(load.energyLevel, 0);
		} else if (load.category == UraniumOre) {
			uranium_ores_count++;
		} else if (load.category == BlackBox) {
			black_boxes_count++;
		} else if (load.category == OrgaMatter) {
			orga_matters_count++;
		} else if (load.category == TNT) {
			tnt_count++;
		} else {
			// may be key
		}
	}
	
	// Count PowerCells and NuclearCells inserted into bots
	// Count items loaded by Grubbers
	items = radarall(bots);
	for (int i = sizeof(items) - 1; i >= 0; --i) {
		if (items[i].energyCell != null) {
			if (items[i].energyCell.category == PowerCell) {
				power_cells_count++;
				power_cells_charge_sum += e.max(items[i].energyCell.energyLevel, 0);
			} else if (items[i].energyCell.category == NuclearCell) {
				nuclear_cells_count++;
				nuclear_cells_charge_sum += e.max(items[i].energyCell.energyLevel, 0);
			} else {
				message("Unexpected cell type", DisplayError);
				return;
			}
		}
		
		if (items[i].load != null) {
			if (items[i].load.category == Titanium) {
				titanium_count++;
			} else if (items[i].load.category == TitaniumOre) {
				titanium_ores_count++;
			} else if (items[i].load.category == PowerCell) {
				power_cells_count++;
				power_cells_charge_sum += e.max(items[i].load.energyLevel, 0);
			} else if (items[i].load.category == NuclearCell) {
				nuclear_cells_count++;
				nuclear_cells_charge_sum += e.max(items[i].load.energyLevel, 0);
			} else if (items[i].load.category == UraniumOre) {
				uranium_ores_count++;
			} else if (items[i].load.category == BlackBox) {
				black_boxes_count++;
			} else if (items[i].load.category == OrgaMatter) {
				orga_matters_count++;
			} else if (items[i].load.category == TNT) {
				tnt_count++;
			} else {
				// may be key
			}
		}
	}
	
	message(_("Titanium", titanium_count)
	      + _("TitaniumOre", titanium_ores_count)
	      + _("PowerCell", e.round_digits(power_cells_charge_sum, 1), power_cells_count)
	      + _("NuclearCell", e.round_digits(nuclear_cells_charge_sum, 1), nuclear_cells_count)
	      + _("UraniumOre", uranium_ores_count)
	      + _("BlackBox", black_boxes_count)
	      + _("OrgaMatter", orga_matters_count)
	      + _("TNT", tnt_count)
	      + _("Wreck", wreck_count));
}
